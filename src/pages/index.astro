---
import Base from '../layouts/Base.astro';
import { getCollection } from 'astro:content';

const recentPosts = (await getCollection('posts', ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 5);

const activeProjects = (await getCollection('projects'))
  .filter(p => p.data.status === 'active')
  .slice(0, 6);

const recentPieces = (await getCollection('pieces'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 6);
---

<Base title="Home">
  <section class="hero">
    <h1>Casey Clan</h1>
    <p class="tagline">Photography, ceramics, art, code, and making things.</p>
  </section>

  {activeProjects.length > 0 && (
    <section class="section">
      <h2>Active Projects</h2>
      <div class="grid">
        {activeProjects.map(project => (
          <a href={`/projects/${project.id}`} class="card">
            <span class="category">{project.data.category}</span>
            <h3>{project.data.title}</h3>
            {project.data.description && <p>{project.data.description}</p>}
          </a>
        ))}
      </div>
      <p class="more"><a href="/projects">View all projects &rarr;</a></p>
    </section>
  )}

  {recentPieces.length > 0 && (
    <section class="section">
      <h2>Recent Work</h2>
      <div class="grid">
        {recentPieces.map(piece => (
          <a href={`/pieces/${piece.id}`} class="card">
            <span class="category">{piece.data.category}</span>
            <h3>{piece.data.title}</h3>
          </a>
        ))}
      </div>
      <p class="more"><a href="/pieces">View gallery &rarr;</a></p>
    </section>
  )}

  {recentPosts.length > 0 && (
    <section class="section">
      <h2>Recent Writing</h2>
      <ul class="post-list">
        {recentPosts.map(post => (
          <li>
            <a href={`/posts/${post.id}`}>
              <span class="date">{post.data.date.toLocaleDateString('en-IE', { day: 'numeric', month: 'short', year: 'numeric' })}</span>
              <span class="title">{post.data.title}</span>
            </a>
          </li>
        ))}
      </ul>
      <p class="more"><a href="/posts">View all posts &rarr;</a></p>
    </section>
  )}

  {recentPosts.length === 0 && activeProjects.length === 0 && recentPieces.length === 0 && (
    <section class="section empty">
      <p>Content coming soon. This site is being built.</p>
    </section>
  )}
</Base>

<style>
  .hero {
    text-align: center;
    padding: 3rem 0 4rem;
    border-bottom: 1px solid var(--color-border);
    margin-bottom: 3rem;
  }

  .hero h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }

  .tagline {
    color: var(--color-text-muted);
    font-size: 1.125rem;
  }

  .section {
    margin-bottom: 3rem;
  }

  .section h2 {
    font-size: 1.25rem;
    margin-bottom: 1rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }

  .card {
    display: block;
    padding: 1.25rem;
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
    color: var(--color-text);
    transition: border-color 0.2s;
  }

  .card:hover {
    border-color: var(--color-accent);
    text-decoration: none;
  }

  .card .category {
    font-size: 0.75rem;
    text-transform: uppercase;
    color: var(--color-text-muted);
    letter-spacing: 0.05em;
  }

  .card h3 {
    font-size: 1.125rem;
    margin: 0.25rem 0;
  }

  .card p {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin: 0;
  }

  .post-list {
    list-style: none;
  }

  .post-list li {
    border-bottom: 1px solid var(--color-border);
  }

  .post-list a {
    display: flex;
    gap: 1rem;
    padding: 0.75rem 0;
    color: var(--color-text);
  }

  .post-list a:hover {
    text-decoration: none;
  }

  .post-list a:hover .title {
    color: var(--color-accent);
  }

  .post-list .date {
    color: var(--color-text-muted);
    font-size: 0.875rem;
    min-width: 6rem;
  }

  .more {
    margin-top: 1rem;
  }

  .empty {
    text-align: center;
    color: var(--color-text-muted);
    padding: 3rem 0;
  }
</style>
